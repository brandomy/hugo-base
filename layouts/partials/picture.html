{{/* Shared responsive image partial
     Usage: {{< picture "hero.jpg" >}} via site-level shortcode.
*/}}

{{ $img := . }}
{{ $widths := slice 480 768 1024 1600 }}

{{ $avif := slice }}
{{ $webp := slice }}
{{ $jpeg := slice }}

{{ range $w := $widths }}
  {{ $avif = $avif | append ($img.Resize (printf "%dx avif q70" $w)) }}
  {{ $webp = $webp | append ($img.Resize (printf "%dx webp q75" $w)) }}
  {{ $jpeg = $jpeg | append ($img.Resize (printf "%dx q80"     $w)) }}
{{ end }}

<picture>
  <source type="image/avif"
          srcset="{{ range $i, $r := $avif }}{{ if $i }}, {{ end }}{{ $r.RelPermalink }} {{ index $widths $i }}w{{ end }}">
  <source type="image/webp"
          srcset="{{ range $i, $r := $webp }}{{ if $i }}, {{ end }}{{ $r.RelPermalink }} {{ index $widths $i }}w{{ end }}">
  <img
    src="{{ (index $jpeg 1).RelPermalink }}"
    srcset="{{ range $i, $r := $jpeg }}{{ if $i }}, {{ end }}{{ $r.RelPermalink }} {{ index $widths $i }}w{{ end }}"
    sizes="(max-width: 768px) 100vw, 768px"
    alt="{{ $.Page.Title }}"
    loading="lazy" decoding="async">
</picture>